# riscure-models

> Pydantic models for Riscure FI/SCA probe specifications and Moku integration

## What is this?

Standalone Pydantic library defining electrical specifications for Riscure FI/SCA probes with voltage-safe wiring validation against Moku platforms.

**Key insight:** Type-safe hardware specifications enable voltage validation before physical connections.

## Core Exports

### Platform Constants

```python
from riscure_models import DS1120A_PLATFORM

# Access probe specification
probe = DS1120A_PLATFORM  # 450V, 64A, fixed 50ns pulse
```

### Key Classes

- `DS1120APlatform` - High-power unidirectional EM-FI probe model
- `SignalPort` - Port specifications with voltage validation
- `ProbeTip` - Interchangeable probe tip specifications

## Basic Usage

```python
from riscure_models import DS1120APlatform, DS1120A_PLATFORM
from moku_models import MOKU_GO_PLATFORM

# Load probe specification
probe = DS1120A_PLATFORM

# Check port specifications
trigger = probe.get_port_by_id('digital_glitch')
print(f"Trigger: {trigger.get_voltage_range_str()}")  # "0.0V to 3.3V"

# Validate voltage compatibility
safe = trigger.is_voltage_compatible(3.3)  # True
unsafe = trigger.is_voltage_compatible(5.0)  # False
```

## Probe Comparison

| Model | Type | Pulse Width | Max Voltage | Max Current | Status |
|-------|------|-------------|-------------|-------------|--------|
| DS1120A | Unidirectional | 50ns (fixed) | 450V | 64A | âœ… Implemented |
| DS1121A | Bidirectional | 4-200ns (adjustable) | 100V | TBD | ðŸš§ Planned |

## DS1120A Port Summary

### Input Ports (Connect FROM Moku)

| Port ID | Voltage Range | Impedance | Type | Moku Compatible |
|---------|---------------|-----------|------|-----------------|
| `digital_glitch` | 0-3.3V TTL | 50Î© | Digital trigger | OutputA/B (TTL) |
| `pulse_amplitude` | 0-3.3V analog | 50Î© | Power control | DACOut1/2 |
| `power_24vdc` | 24-450V DC | N/A | External PSU | External only |

### Output Ports (Connect TO Moku)

| Port ID | Voltage Range | Impedance | Coupling | Moku Compatible |
|---------|---------------|-----------|----------|-----------------|
| `coil_current` | -1.4V to 0V | 50Î© | AC | InputA/B (AC, 50Î© term) |

## Common Tasks

**Query port specs:**
```python
from riscure_models import DS1120A_PLATFORM

probe = DS1120A_PLATFORM

# List all input ports
for port in probe.get_input_ports():
    print(f"{port.port_id}: {port.get_voltage_range_str()}")

# Get specific port
current_monitor = probe.get_port_by_id('coil_current')
print(f"Coupling: {current_monitor.coupling}")  # "AC"
```

**Check probe tip options:**
```python
probe = DS1120A_PLATFORM

# List available tips
for tip in probe.available_tips:
    print(f"{tip.tip_id}: {tip.diameter_mm}mm, {tip.max_current_a}A max")

# Get specific tip
tip = probe.get_tip_by_id('4mm_positive')
print(f"Max current: {tip.max_current_a}A")
```

**Validate wiring with Moku:**
```python
from riscure_models import DS1120A_PLATFORM
from moku_models import MOKU_GO_PLATFORM

# Load specifications
probe = DS1120A_PLATFORM
moku = MOKU_GO_PLATFORM

# Get probe input port
trigger_port = probe.get_port_by_id('digital_glitch')

# Get Moku output port (future: direct compatibility check)
moku_output = moku.get_analog_output_by_id('OUT1')

# Manual voltage validation
voltage = 3.3  # Moku TTL output
if trigger_port.is_voltage_compatible(voltage):
    print("âœ“ Safe connection")
else:
    print("âš  Voltage incompatibility!")
```

## File Structure

```
riscure_models/
â”œâ”€â”€ __init__.py      # Public API (import from here)
â””â”€â”€ probes/
    â”œâ”€â”€ __init__.py
    â”œâ”€â”€ ds1120a.py   # DS1120APlatform, SignalPort, ProbeTip
    â””â”€â”€ ds1121a.py   # (Future) DS1121A bidirectional probe
```

## Key Design Principles

1. **Voltage safety first** - Explicit voltage_min/voltage_max for safety validation
2. **Moku integration** - Mirror moku-models patterns for seamless compatibility
3. **Pure specifications** - No control logic, just validated hardware specs
4. **Extensible** - Template for DS1121A, laser probes, and future devices

## Important Notes

- **Fixed pulse width**: DS1120A always outputs 50ns pulses (hardware limitation)
- **External PSU required**: 24-450V DC power supply not provided by Moku
- **AC coupling required**: coil_current output is transient pulse
- **Probe tips are interchangeable**: Affects field strength, not electrical interface

## Integration Notes

**Used by:** moku-instrument-forge, wiring validation tools, safety checking frameworks

**Works with:**
- [moku-models](https://github.com/sealablab/moku-models) (sibling library) - Platform voltage compatibility
- [basic-app-datatypes](https://github.com/sealablab/basic-app-datatypes) (sibling library) - Type system integration

**Validation flow:** Moku platform specs + Probe port specs â†’ Voltage safety validation â†’ Wiring diagram

**Wiring pattern:** See CLAUDE.md for complete diagrams and safety notes

## For More Details

**Deep context:** See [CLAUDE.md](CLAUDE.md) for:
- Complete DS1120A specifications and wiring diagrams
- Integration patterns with moku-models
- Voltage safety validation patterns
- Development workflow for adding probe models

**Installation:** See [README.md](README.md)

---

**Version:** 0.1.0
**Last Updated:** 2025-11-04
**License:** MIT
**Part of:** [moku-instrument-forge-mono-repo](https://github.com/sealablab/moku-instrument-forge-mono-repo) (monorepo orchestrator)
**Used by:** [moku-instrument-forge](https://github.com/sealablab/moku-instrument-forge) (forge code generation)
